#!/usr/bin/env python
# coding: utf-8

# training of the GBM model with GVAE-reduced features

import pickle

import torch
import numpy as np
from torch_geometric.data import Data, DataLoader
from torch_geometric.utils import train_test_split_edges
from sklearn.ensemble import GradientBoostingClassifier
from sklearn.model_selection import KFold
from sklearn.metrics import f1_score
import pandas as pd


[gae, Labels]=pickle.load(open("data_gae_20.p","rb"))
#[gae, Labels]=pickle.load(open("data_gae_30.p","rb"))
#[gae, Labels]=pickle.load(open("data_gae_40.p","rb"))
#[gae, Labels]=pickle.load(open("data_gae_50.p","rb"))


for i in range(0,len(gae)):    
  
    arr.append(np.mean(np.array(gae[i]),axis=0))
    print (len(arr))






k_folds = 10
max_depth=[9,11]
min_split=[2,3,4]

all_results=pd.DataFrame(columns=["max_depth","min_split","acc","fm","acc_folds","fm_folds"])
cnt=0
kfold = KFold(n_splits=k_folds, shuffle=True,random_state=123)


for dept in max_depth:
    for split in min_split:
        acc_results=[]
        f_results=[]
        print (dept)
        for fold, (train_ids, test_ids) in enumerate(kfold.split(train)):
            print(f'FOLD {fold}')
            print('--------------------------------')

            clf = GradientBoostingClassifier(n_estimators=1500, learning_rate=0.01,
                max_depth=dept, random_state=0,verbose=1,min_samples_split=split).fit(train[train_ids], y[train_ids])

            acc_results.append(clf.score(train[test_ids,:], y[test_ids]))
            f_results.append(f1_score(y[test_ids],clf.predict(train[test_ids])))
            
        all_results.loc[cnt]=[dept,split,np.mean(acc_results),np.mean(f_results),acc_results,f_results]
        print (all_results)
        cnt=cnt+1


all_results.to_csv("20_gbm.csv",index=False)
# In[ ]:




